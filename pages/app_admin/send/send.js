(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/app_admin/send/send"],{"1b3d":function(e,t,i){"use strict";i.r(t);var s=i("abba"),n=i("976a");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r);i("4b6d");var o=i("5d22"),d=Object(o["a"])(n["default"],s["a"],s["b"],!1,null,"c5d75332",null);t["default"]=d.exports},"4b6d":function(e,t,i){"use strict";i("d5ed")},"976a":function(e,t,i){"use strict";i.r(t);var s=i("9b8f"),n=i.n(s);for(var r in s)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(r);t["default"]=n.a},"9b8f":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i("7736");function n(e,t){var i;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=r(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return d=e.done,e},e:function(e){a=!0,o=e},f:function(){try{d||null==i.return||i.return()}finally{if(a)throw o}}}}function r(e,t){if(e){if("string"===typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l={data:function(){return{express_no:"",express:"",customer_name:"",express_content:"",code:"",words:"",list:[],detail:{},dialog:!1,iphone_x:!1,id:"",chooseIndex:[0],express_id:0,newIndex:0,is_express:-2,is_send:0,order_refund_id:0,express_single:{},city:{cityList:[],deliveryId:null,delivery:"",cityServiceList:[],cityServiceId:null,cityService:"",isPreview:0,fee:0,name:"",delivery_no:""}}},computed:a({},(0,s.mapState)({userInfo:function(e){return e.user.info},adminImg:function(e){return e.mallConfig.__wxapp_img.app_admin}})),methods:{chooseAddress:function(e){if(this.is_send){var t,i=n(this.detail.detailExpress);try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.id==e.expressRelation.order_detail_express_id){this.express=s.express,this.is_express=2==s.send_type?0:1,this.express_content=s.express_content,this.express_no=s.express_no,this.express_id=s.id,this.customer_name=s.customer_name,this.code="",this.words=s.merchant_remark,this.code=s.code>0?s.code:"";var r,o=n(this.detail.detail);try{for(o.s();!(r=o.n()).done;){var d=r.value;d.choose=!1;var a,c=n(s.expressRelation);try{for(c.s();!(a=c.n()).done;){var l=a.value;l.order_detail_id==d.id&&(d.choose=!0)}}catch(u){c.e(u)}finally{c.f()}}}catch(u){o.e(u)}finally{o.f()}}}}catch(u){i.e(u)}finally{i.f()}}else e.choose=!e.choose;this.$forceUpdate()},toggleExpress:function(e){if(this.is_express=e,2==this.detail.send_type)for(var t in this.list=2==e?this.city.cityList:this.city.cityServiceList,this.list)2==this.is_express?this.list[t].id==this.city.deliveryId&&(this.chooseIndex[0]=+t,this.newIndex=+t):this.list[t].id==this.city.cityServiceId&&(this.chooseIndex[0]=+t,this.newIndex=+t)},bindChange:function(e){this.newIndex=e.detail.value[0]},toPick:function(e){var t=this;1==e?(t.customer_name="",t.newIndex=t.chooseIndex[0]):t.newIndex=t.chooseIndex[0],setTimeout((function(){t.dialog=!t.dialog}))},closeDialog:function(e){1==e?(this.chooseIndex[0]=this.newIndex,2==this.detail.send_type?2==this.is_express?(this.city.delivery="("+this.list[this.chooseIndex[0]].id+")"+this.list[this.chooseIndex[0]].name,this.city.deliveryId=this.list[this.chooseIndex[0]].id):(this.city.cityService="("+this.list[this.chooseIndex[0]].id+")"+this.list[this.chooseIndex[0]].name,this.city.cityServiceId=this.list[this.chooseIndex[0]].id,this.city.isPreview=0):this.express=this.list[this.newIndex].name):this.newIndex=this.chooseIndex[0],this.dialog=!this.dialog},getExpressNo:function(){var t=this;e.showLoading({mask:!0,title:"加载中..."}),t.$request({url:t.$api.app_admin.print,data:{express:t.express,code:t.code,order_id:t.id,order_detail_ids:JSON.stringify(t.getIdList())}}).then((function(i){e.hideLoading(),0==i.code?(t.express_no=i.data.Order.LogisticCode,t.express_single=i.data.express_single):e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading()}))},getExpress:function(){var t=this;e.showLoading({mask:!0,title:"加载中..."}),t.$request({url:t.$api.app_admin.express}).then((function(i){e.hideLoading(),0==i.code?(t.list=i.data.list,t.getList()):e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading()}))},getList:function(){var t=this,i=this;e.showLoading({mask:!0,title:"加载中..."}),i.$request({url:i.$api.app_admin.detail,data:{order_id:i.id},method:"post"}).then((function(s){if(e.hideLoading(),0==s.code){for(var n in i.detail=s.data.order,2==t.detail.send_type?(i.getDelivery(),i.is_express=2):i.is_express=1,i.detail.detail)i.detail.detail[n].choose=!0;var r=i.is_send?1:0;for(var o in i.detail.detailExpress.length>r&&i.detail.detail.forEach((function(e){for(var t=r;t<i.detail.detailExpress.length;t++)for(var s in i.detail.detailExpress[t].expressRelation)i.detail.detailExpress[t].expressRelation[s].order_detail_id==e.id&&(e.choose=!i.is_send&&2)})),i.is_send>0?(i.express=s.data.order.detailExpress[0].express,i.is_express=2==s.data.order.detailExpress[0].send_type?0:1,i.express_content=s.data.order.detailExpress[0].express_content,i.express_no=s.data.order.detailExpress[0].express_no,i.express_id=s.data.order.detailExpress[0].id,i.customer_name=s.data.order.detailExpress[0].customer_name,i.code="",i.words=s.data.order.detailExpress[0].merchant_remark,s.data.order.code>0&&(i.code=s.data.order.detailExpress[0].code)):i.express=s.data.order.last_express?s.data.order.last_express:i.list[0].name,i.list)i.list[o].name==i.express&&(i.chooseIndex[0]=o)}else e.showToast({title:s.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading()}))},saveAddress:function(t){var i=this;if(1!=i.is_express||i.express_no){var s=i.getIdList();if(0!=s.length||0!=i.order_refund_id){e.showLoading({mask:!0,title:"提交中..."});var n={is_express:1,order_id:i.id,express_no:i.express_no,express:i.express,code:i.code,customer_name:i.customer_name,merchant_remark:i.words,express_content:"",order_detail_id:JSON.stringify(s),express_single_id:i.express_single.id?i.express_single.id:0};0==i.is_express&&(n={is_express:2,order_id:i.id,express_content:i.express_content,order_detail_id:JSON.stringify(s)}),i.is_send>0&&(n.express_id=i.express_id),i.order_refund_id>0?i.$request({url:i.$api.app_admin.refund_handle,method:"POST",data:{is_express:1,type:2,is_agree:1,order_refund_id:i.order_refund_id,express_no:i.express_no,express:i.express,merchant_remark:i.words}}).then((function(t){if(e.hideLoading(),0==t.code){var i=t.msg;e.showToast({title:i,duration:1e3,icon:"success",mask:!1}),setTimeout((function(){e.navigateBack()}),500)}else e.showToast({title:t.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading(),e.showToast({title:t,icon:"none",duration:1e3})})):i.$request({url:i.$api.app_admin.send,method:"POST",data:n}).then((function(t){if(e.hideLoading(),0==t.code){var s=t.msg;2==i.is_send&&(s="修改成功"),e.showToast({title:s,duration:1e3,icon:"success",mask:!1}),setTimeout((function(){e.navigateBack()}),500)}else e.showToast({title:t.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading(),e.showToast({title:t,icon:"none",duration:1e3})}))}else e.showToast({title:"请选择发货商品",icon:"none",duration:1e3})}else e.showToast({title:"快递单号不得为空",icon:"none",duration:1e3})},getIdList:function(){var e=this,t=[];for(var i in e.detail.detail)e.detail.detail[i].choose&&2!=e.detail.detail[i].choose&&t.push(e.detail.detail[i].id);return t},getDelivery:function(){var t=this,i=this;i.$request({url:i.$api.app_admin.delivery}).then((function(s){if(0===s.code){s.data.list.length>0&&(t.city.cityList=s.data.list,t.city.deliveryId=s.data.list[0].id,t.city.delivery="("+s.data.list[0].id+")"+s.data.list[0].name,t.list=t.city.cityList,t.is_express=2);var n=s.data.city_service_list;if(n.length>0){var r=[];n.forEach((function(e,t){("第三方"==e.service_type||"wxapp"==i.detail.platform&&"微信"==e.service_type)&&r.push(e)})),t.city.cityServiceList=r,t.city.cityServiceId=r[0].id,t.city.cityService="("+r[0].id+")"+r[0].name}}else e.showToast({title:s.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading()}))},citySend:function(){var t,i=this;if(2==i.detail.send_type){e.showLoading({mask:!0,title:"加载中..."});var s=i.getIdList();if(0==s.length&&0==i.order_refund_id)return void e.showToast({title:"请选择发货商品",icon:"none",duration:1e3});t={is_express:i.is_express,words:"",order_id:i.detail.id,order_detail_id:JSON.stringify(s),city_service:i.city.cityService,is_preview:i.city.isPreview?0:1,delivery_no:i.city.delivery_no},2==i.detail.send_type&&(t.man=i.city.delivery),i.is_send>0&&(t.express_id=i.express_id),i.$request({url:i.$api.app_admin.send,data:t,method:"post"}).then((function(t){if(e.hideLoading(),0===t.code){var s=t.data;s&&1==s.preview_success?(i.city.fee=s.fee,i.city.isPreview=1,i.city.name=s.name,i.city.isPreview=1,i.city.delivery_no=s.delivery_no):setTimeout((function(){e.navigateBack()}),500),e.showToast({title:t.msg,type:"success",mask:!1,duration:2e3})}else e.showToast({title:t.msg,icon:"none",duration:1e3})})).catch((function(t){e.hideLoading(),e.showToast({title:t,icon:"none",duration:1e3})}))}}},onLoad:function(t){this.$commonLoad.onload(t);var i=this;e.getSystemInfo({success:function(e){(e.model.indexOf("iPhone X")>-1||e.model.indexOf("iPhone 11")>-1||e.model.indexOf("iPhone11")>-1||e.model.indexOf("iPhone12")>-1||e.model.indexOf("Unknown Device")>-1)&&(i.iphone_x=!0)}}),t.id>0&&(i.id=t.id),t.order_refund_id>0&&(i.order_refund_id=t.order_refund_id),0==t.send_type?i.getExpress():(e.showLoading({mask:!0,title:"加载中..."}),i.getList()),t.is_send>0&&(i.is_send=t.is_send)}};t.default=l}).call(this,i("d2c1")["default"])},abba:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));var s=function(){var e=this,t=e.$createElement;e._self._c},n=[]},d5ed:function(e,t,i){}},[["20aa","common/runtime","common/vendor"]]]);