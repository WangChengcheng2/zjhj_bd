(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["plugins/mch/mch/add-goods/add-goods"],{1485:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(i("b096")),r=i("7736"),n=s(i("d5ea"));function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t,i,o,r,n,s){try{var a=e[n](s),c=a.value}catch(d){return void i(d)}a.done?t(c):Promise.resolve(c).then(o,r)}function c(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var n=e.apply(t,i);function s(e){a(n,o,r,s,c,"next",e)}function c(e){a(n,o,r,s,c,"throw",e)}s(void 0)}))}}function d(e,t){var i;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=h(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){a=!0,n=e},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw n}}}}function h(e,t){if(e){if("string"===typeof e)return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){f(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _={data:function(){return{id:0,postageIndex:-1,deliveryIndex:-1,height:0,beSubmit:!1,form:{cats:[],mchCats:[],name:"",cost_price:"",price:"",original_price:"",type:"goods",attr_default_name:"默认规格"},forehead:-1,unit:"件",set_attr:!1,iphone_x:!1,modal:!1,error:!1,set_cat:!1,set_mch_cat:!1,set_postage:!1,set_delivery:!1,set_service:!1,is_default_services:!0,confine:!1,is_service:!1,img:[],cat:[],mch:0,mch_cat:[],goods_detail:[],beMove:!1,service:[],postage:[],beCat:[],beMchCat:[],isChooseCat:["未选择"],delivery:[],bePostage:"",beDelivery:"",beService:[],newIndex:"0",index:"0",attr:!1,have_children:!1,disabled:!0,imgHidden:!0,flag:!1,x:0,y:0,first_service:!0,choose_list:[],elements:[],img_src:"",dialogType:"",dialog:!1,inputName:!0,beginIndex:null,loading:!1,limit_buy_status:0,min_number:1,limit_buy_first:!0,limit_buy_second:!0,limit_buy_type:"day",limit_buy_value:-1}},computed:u({},(0,r.mapState)({userInfo:function(e){return e.user.info},adminImg:function(e){return e.mallConfig.__wxapp_img.app_admin}})),methods:{bindChange:function(e){this.newIndex=e.detail.value[0]},toggle:function(e){this.choose_list=[],this.dialog=!1,this.set_cat=!1,"postage"==this.dialogType&&(1==e?this.set_postage&&(this.bePostage=this.postage[this.newIndex]):this.set_postage=!1),"delivery"==this.dialogType&&(1==e?this.set_delivery&&(this.beDelivery=this.delivery[this.newIndex]):this.set_delivery=!1),this.dialogType=""},money:function(e){var t=e.toString();return 0==t.indexOf(".")&&(t="0"+t),t=t.replace(/[^\d.]/g,""),t=t.replace(/\.{2,}/g,"."),t=t.replace(".","$#$").replace(/\./g,"").replace("$#$","."),t=t.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),t.indexOf(".")<0&&""!=t&&(t=parseFloat(t)),+t},costChange:function(e){this.form.cost_price=this.money(e.detail.value)},originalChange:function(e){this.form.original_price=this.money(e.detail.value)},priceChange:function(e){this.form.price=this.money(e.detail.value)},nameBlur:function(){this.inputName=!this.inputName},changeConfine:function(){this.confine=!this.confine,this.confine&&-1==this.form.confine_count&&(this.form.confine_count="")},chooseAttr:function(){e.navigateTo({url:"/plugins/mch/mch/goods-attr/goods-attr"}),this.$storage.setStorageSync("goods_unit",this.unit)},toSubmit:function(){var t=this;if(t.loading)return!1;e.showLoading({title:"提交中..."}),t.beSubmit=!1,t.loading=!0,t.$request({url:t.$api.mch.edit,data:{form:JSON.stringify(t.form),mch_id:t.mch_id},method:"post"}).then((function(i){t.loading=!1,t.$hideLoading(),0==i.code?(t.$hideLoading(),e.hideLoading(),0==i.code?(e.showToast({title:i.msg,duration:1e3}),setTimeout((function(){e.navigateBack()}),500)):e.showToast({title:i.msg,icon:"none",duration:1e3})):e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(){t.loading=!1,t.$hideLoading(),e.hideLoading()}))},submit:function(){var e=!1,t=this,i=t.form;if(i.status=this.form.status?this.form.status:1,i.cats=[],i.mchCats=[],0==t.beCat.length)return t.error="请设置商品分类",!1;if(t.beCat.forEach((function(e){i.cats.push(e.value)})),0==t.beMchCat.length)return t.error="请设置多商户分类",!1;if(t.beMchCat.forEach((function(e){i.mchCats.push(e.value)})),!(t.img.length>0))return t.error="请上传商品图片",!1;if(i.pic_url=t.img,!i.name)return t.error="请设置商品名称",!1;if(!t.unit)return t.error="请设置商品单位",!1;if(i.unit=t.unit,0!=i.cost_price&&!i.cost_price)return t.error="请设置商品成本价",!1;if(i.cost_price<0)return t.error="成本价不得小于零",!1;if(0!=i.original_price&&!i.original_price)return t.error="请设置商品原价",!1;if(i.original_price<0)return t.error="商品原价不得小于零",!1;if(0!=i.price&&!i.price)return t.error="请设置商品售价",!1;if(t.set_attr){if(i.use_attr=1,i.goods_num=0,!i.attr_groups||0==i.attr_groups.length)return t.error="请设置商品规格",!1;e=!0}else{if(i.use_attr=0,i.attr=[],!i.goods_num)return t.error="商品库存不得为空",!1;if(i.goods_num<0)return t.error="商品库存不得小于零",!1;e=!0}if(i.cards=t.goods_card,i.is_default_services=1,i.services=[],t.form.limit_buy_status=t.confine?1:0,0==t.is_default_services&&(i.is_default_services=0,t.beService.length>0&&(i.services=t.beService)),!(t.goods_detail.length>0))return t.error="请设置图文描述",!1;for(var o in i.detail="",t.goods_detail)"img"==t.goods_detail[o].type?i.detail+='<p><img src="'+t.goods_detail[o].pic_url+'"/></p>':"line"==t.goods_detail[o].type?i.detail+='<p><img src="'+t.adminImg.line+'"/></p>':"text"==t.goods_detail[o].type&&(i.detail+="<p>"+t.goods_detail[o].text+"</p>");t.forehead_integral&&(t.forehead_integral>0?(i.forehead_integral_type=1,i.forehead_integral=t.forehead_integral):(i.forehead_integral_type=2,i.forehead_integral=t.forehead_integral.replace("%",""))),t.give_integral&&(t.give_integral>0?(i.give_integral_type=1,i.give_integral=t.give_integral):(i.give_integral_type=2,i.give_integral=t.give_integral.replace("%",""))),i.virtual_sales||(i.virtual_sales=0),i.cover_pic||(i.cover_pic=""),i.sort||(i.sort=100),i.accumulative||(i.accumulative=1),i.member_price||(i.member_price={}),i.freight_id=t.bePostage.id,i.freight=t.bePostage,i.shipping_id=t.beDelivery.id,i.shipping=t.beDelivery,i.individual_share||(i.individual_share=0),i.is_level||(i.is_level=0),i.individual_share||(i.individual_share=0),i.video_url||(i.video_url=""),i.mch_id=t.mch_id,i.sign="mch",e&&(t.form=i,t.id>0?(t.form.id=t.id,t.toSubmit()):t.beSubmit=!0)},close:function(){this.error=null,this.set_cat=!1,this.set_mch_cat=!1,this.set_postage=!1,this.set_service=!1,this.modal=!1},inputAttr:function(e){this.attr[e].attr_list[0].attr_id=(+e+2).toString()},_longtap:function(t,i,o){var r=this,n=e.createSelectorQuery(),s=n.selectAll(".move-img");s.fields({dataset:!0,rect:!0},(function(e){r.elements=e})).exec(),r.img[i].pic_url="",r.x=o.currentTarget.offsetLeft,r.y=o.currentTarget.offsetTop,r.imgHidden=!1,r.flag=!0,r.beMove=!0,r.img_src=t,r.beginIndex=i},touchend:function(e){var t=this;if(t.flag){for(var i=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,r=t.elements,n=t.img,s=t.beginIndex,a=0;a<r.length;a++){var c=r[a];if(i>c.left&&i<c.right&&o>c.top&&o<c.bottom){var d=c.dataset.index;if(s<d){for(var h=n[s],g=s;g<d;g++)n[g]=n[g+1];n[d]=h}if(s>d){for(var l=n[s],u=s;u>d;u--)n[u]=n[u-1];n[d]=l}n[d].pic_url=t.img_src,t.img=n}}t.img[s].pic_url||(t.img[s].pic_url=t.img_src),t.imgHidden=!0,t.flag=!1,t.beMove=!1,t.beginIndex=null}},touchm:function(e){if(this.flag){var t=e.touches[0].pageX,i=e.touches[0].pageY;this.x=t-60,this.y=i-129}},cancelService:function(){var e=this.beService,t=this.service;e.length>0?t.forEach((function(t){t.isChoose=!1,e.forEach((function(e){e.id==t.id&&(t.isChoose=!0)}))})):t.forEach((function(e){e.isChoose=!1})),this.beService=e,this.service=t,this.set_service=!1,this.is_service=!1},submitService:function(){var e=[];this.service.forEach((function(t){t.isChoose&&e.push(t)})),this.beService=e,this.set_service=!1,this.is_service=!1},choose:function(e){var t=this;t.service.forEach((function(i){i.id==e.id&&(i.isChoose=!i.isChoose,t.$forceUpdate())}))},toGoodsDetail:function(){e.navigateTo({url:"/plugins/mch/mch/goods-detail/goods-detail?mch_id="+this.mch_id})},add_img:function(){var t=this,i=9-t.img.length;e.chooseImage({count:i,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){var o=i.tempFilePaths,r=t.img;o.forEach((function(i,s){e.showLoading({title:"上传中..."});var a="";(0,n.default)({url:t.$api.upload.file,filePath:i,fileType:"image",fileName:a,mch_id:t.mch_id}).then((function(i){var n=JSON.parse(i.data),a={pic_url:n.data.url,id:n.data.id};0==n.code&&r.push(a),t.img=r,s==o.length-1&&e.hideLoading()}))}))}})},del_img:function(e){this.img.splice(e,1)},chooseCat:function(t){e.navigateTo({url:"/pages/goods-edit/goods-cat/goods-cat?type="+t+"&mch_id="+this.mch_id})},chooseService:function(){var t=this;t.first_service?t.$request({url:t.$api.mch.service,data:{mch_id:t.mch_id}}).then((function(i){if(t.$hideLoading(),0==i.code){t.service=i.data.list,0==i.data.list.length?t.modal=!0:t.is_service=!0;var o,r=[],n=d(i.data.list);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(s.isChoose=!1,1==t.is_default_services)1==s.is_default&&(r.push(s),s.isChoose=!0);else{var a,c=d(t.beService);try{for(c.s();!(a=c.n()).done;){var h=a.value;s.id==h.id&&(s.isChoose=!0)}}catch(g){c.e(g)}finally{c.f()}}}}catch(g){n.e(g)}finally{n.f()}t.set_service=!0,1==t.is_default_services&&(t.beService=r,t.default_service=r),t.first_service=!1}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(){t.$hideLoading()})):0==t.service.length?t.modal=!0:t.is_service=!0},chooseExpress:function(){var t=this;t.$request({url:t.$api.mch.postage,data:{mch_id:t.mch_id}}).then((function(i){if(t.$hideLoading(),0==i.code)if(0==i.data.list.length)t.set_postage=!0,t.modal=!0,t.postage=i.data.list;else{var o=[];i.data.list.forEach((function(e,t){o.push(i.data.list[t].id)}));var r=o.indexOf(t.bePostage.id);r>-1?(t.postageIndex=+r,t.newIndex=+r):t.bePostage="",t.set_postage=!0,t.dialog=!0,t.dialogType="postage",t.postage=i.data.list}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(){t.$hideLoading()}))},chooseDelivery:function(){var t=this;t.$request({url:t.$api.mch.delivery_rules,data:{mch_id:t.mch_id}}).then((function(i){if(t.$hideLoading(),0==i.code)if(0==i.data.list.length)t.set_delivery=!0,t.modal=!0,t.delivery=i.data.list;else{var o=[];i.data.list.forEach((function(e,t){o.push(i.data.list[t].id)}));var r=o.indexOf(t.beDelivery.id);r>-1?(t.deliveryIndex=+r,t.newIndex=+r):t.beDelivery="",t.set_delivery=!0,t.dialog=!0,t.dialogType="delivery",t.delivery=i.data.list}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(){t.$hideLoading()}))},getService:function(){var t=this;t.$request({url:t.$api.mch.service,data:{mch_id:t.mch_id}}).then((function(i){if(t.$hideLoading(),0==i.code){for(var o in t.service=i.data.list,t.service)t.service[o].isChoose=!1;if(id>0)for(var r in t.beService)for(var n in t.service)t.service[n].id==t.beService[r].id&&(t.service[n].isChoose=!0,t.first_service=!1);else t.beService=[],data.list.forEach((function(e){e.isChoose=!1,1==e.is_default&&(t.beService.push(e),e.isChoose=!0)}))}else e.showToast({title:i.msg,icon:"none",duration:1e3})})).catch((function(){t.$hideLoading()}))},getPostage:function(t){var i=this;i.$request({url:i.$api.mch.postage,data:{mch_id:i.mch_id}}).then((function(o){if(i.$hideLoading(),0==o.code){if(i.postage=o.data.list,t>0)return!1;i.bePostage="",i.bePostage=o.data.list[0]}else e.showToast({title:o.msg,icon:"none",duration:1e3})})).catch((function(){i.$hideLoading()}))},getDelivery:function(t){var i=this;this.$request({url:this.$api.mch.delivery_rules,data:{mch_id:i.mch_id}}).then((function(o){if(i.$hideLoading(),0==o.code){if(i.delivery=o.data.list,t>0)return!1;i.beDelivery="",i.beDelivery=o.data.list[0]}else e.showToast({title:o.msg,icon:"none",duration:1e3})})).catch((function(){i.$hideLoading()}))},getDetail:function(){var t=c(o.default.mark((function t(i){var r,n,s,a,c,d,h,g,l,u,f,_,m,v,p,y,b,S,$,x,w,O,C,T,P,L,I,j,D,E,M,q;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$request({url:this.$api.mch.goods_edit,data:{id:i,mch_id:this.mch_id}});case 2:return r=t.sent,n=r.code,s=r.data,a=r.msg,t.next=6,this.$hideLoading();case 6:if(this.getService(i),this.getPostage(i),this.getDelivery(i),0===n){for(E in this.form=s.detail,c=this.form,d=c.pic_url,h=c.cats,g=c.use_attr,l=c.mchCats,u=c.services,f=c.freight,_=c.cards,m=c.confine_count,v=c.is_default_services,p=c.forehead_integral,y=c.forehead_integral_type,b=c.give_integral,S=c.give_integral_type,$=c.attr_groups,x=c.attr,w=c.detail,O=c.unit,C=c.shipping,T=c.min_number,P=c.limit_buy_status,c.limit_buy_type,L=c.limit_buy_value,this.img=d,this.beCat=h,this.beMchCat=l,this.set_attr=1==g,this.beService=u,this.bePostage=f,this.goods_card=_,this.beDelivery=C,this.unit=O,this.min_number=T,1==P&&(this.confine=!0),m>0&&(this.limit_buy_first=!1),L>0&&(this.limit_buy_second=!1),0==v&&(this.is_default_services=!1),this.forehead_integral=+p,2==y&&(this.forehead_integral=p+"%"),this.give_integral=+b,2==S&&(this.give_integral=b+"%"),$.length>0&&x.length>0&&(this.attr=!0,this.$storage.setStorageSync("goods_attr_groups",$),this.$storage.setStorageSync("goods_attr",x)),I=w.split(/<\/p>|<br\/>|<img /),j=[],D=void 0,I)I[E]=I[E].replace(/<p>/g,"").replace(/<\/p>/g,""),D={type:""},I[E].indexOf("src")>-1?(D.type="img",D.id="",M=I[E].indexOf(".png")>-1?I[E].indexOf(".png")+4:I[E].length-1,I[E].indexOf(".jpg")>-1&&(M=I[E].indexOf(".jpg")+4),I[E].indexOf(".jpeg")>-1&&(M=I[E].indexOf(".jpeg")+5),I[E].indexOf(".gif")>-1&&(M=I[E].indexOf(".gif")+4),D.pic_url=I[E].slice(I[E].indexOf("http"),M)):(D.type="text",D.text=I[E]),j[E]=D;for(q in j)""===j[q].text&&j.splice(q,1);this.goods_detail=j,this.$storage.setStorageSync("goods_card",_),this.$storage.setStorageSync("mch_goods_cat",this.beCat),this.$storage.setStorageSync("mch_goods_mch_cat",this.beMchCat),this.$storage.setStorageSync("goods_detail",j)}else e.showToast({title:a,icon:"none",duration:1e3});case 10:case"end":return t.stop()}}),t,this)})));function i(e){return t.apply(this,arguments)}return i}(),limitBuyFirstChange:function(e){"1"===e.target.value?(this.limit_buy_first=!0,this.form.confine_count=-1):(this.limit_buy_first=!1,this.form.confine_count="")}},onLoad:function(t){this.$commonLoad.onload(t);var i=this;e.getSystemInfo({success:function(e){(e.model.indexOf("iPhone X")>-1||e.model.indexOf("iPhone 11")>-1||e.model.indexOf("iPhone11")>-1||e.model.indexOf("iPhone12")>-1||e.model.indexOf("Unknown Device")>-1)&&(i.iphone_x=!0)}}),i.mch_id=t.mch_id,e.getSystemInfo({success:function(e){var t=e.windowHeight,o=e.windowWidth,r=750/o;i.height=t*r}}),this.$storage.removeStorageSync("mch_goods_cat"),this.$storage.removeStorageSync("mch_goods_mch_cat"),this.$storage.removeStorageSync("goods_unit"),this.$storage.removeStorageSync("goods_attr_groups"),this.$storage.removeStorageSync("goods_attr"),this.$storage.removeStorageSync("temp_attr"),this.$storage.removeStorageSync("temp_attr_info"),this.$storage.removeStorageSync("goods_detail"),i.goods_card=[],i.goods_detail=[],t.id>0?(i.$showLoading({type:"global",text:"加载中..."}),i.id=t.id,setTimeout((function(){e.setNavigationBarTitle({title:"编辑商品"}),i.getDetail(t.id)}),500)):(i.getService(),i.getPostage(),i.getDelivery())},onShow:function(){this.goods_card=this.$storage.getStorageSync("goods_card")?this.$storage.getStorageSync("goods_card"):[],this.beCat=this.$storage.getStorageSync("mch_goods_cat")?this.$storage.getStorageSync("mch_goods_cat"):[],this.beMchCat=this.$storage.getStorageSync("mch_goods_mch_cat")?this.$storage.getStorageSync("mch_goods_mch_cat"):[],this.goods_detail=this.$storage.getStorageSync("goods_detail")?this.$storage.getStorageSync("goods_detail"):[],this.form.attr=this.$storage.getStorageSync("goods_attr")?this.$storage.getStorageSync("goods_attr"):[],this.$storage.getStorageSync("goods_attr_groups")&&(this.form.attr_groups=this.$storage.getStorageSync("goods_attr_groups"),this.attr=!0),this.$storage.removeStorageSync("temp_attr"),this.$storage.removeStorageSync("temp_attr_info")}};t.default=_}).call(this,i("d2c1")["default"])},"1ccd":function(e,t,i){},2583:function(e,t,i){"use strict";i("1ccd")},"4b13":function(e,t,i){"use strict";i.r(t);var o=i("1485"),r=i.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(n);t["default"]=r.a},a250:function(e,t,i){"use strict";i.r(t);var o=i("d28b"),r=i("4b13");for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n);i("2583");var s=i("5d22"),a=Object(s["a"])(r["default"],o["a"],o["b"],!1,null,"c1e20484",null);t["default"]=a.exports},ae58:function(e,t){e.exports=require("../siteinfo.js")},d28b:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var o=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.set_attr=!e.set_attr},e.e1=function(t){e.is_default_services=!e.is_default_services})},r=[]}},[["0202","common/runtime","common/vendor"]]]);